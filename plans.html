<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Investment Plans</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'Inter',sans-serif;background:#fafafa;min-height:100vh;padding:40px 20px 100px}
        .container{max-width:1200px;margin:0 auto}
        .header{text-align:center;margin-bottom:32px}
        .header h1{font-size:32px;font-weight:700;color:#0f172a;margin-bottom:8px}
        .header p{font-size:16px;color:#64748b}
        .balance-display{background:linear-gradient(135deg,#10b981,#059669);color:white;padding:20px;border-radius:16px;text-align:center;margin-bottom:24px;box-shadow:0 4px 20px rgba(16,185,129,.25);position:relative;overflow:hidden}
        .balance-display::before{content:'';position:absolute;top:-50%;left:-50%;width:200%;height:200%;background:linear-gradient(45deg,transparent,transparent 40%,rgba(255,255,255,.15) 50%,transparent 60%,transparent);animation:shine 3s infinite}
        @keyframes shine{0%{transform:translateX(-100%) translateY(-100%) rotate(45deg)}100%{transform:translateX(100%) translateY(100%) rotate(45deg)}}
        .balance-content{position:relative;z-index:1}
        .balance-label{font-size:14px;opacity:.9;margin-bottom:8px;font-weight:500}
        .balance-amount{font-size:36px;font-weight:700}
        .info-note{background:#dbeafe;border:2px solid #3b82f6;color:#1e40af;padding:14px;border-radius:12px;margin-bottom:24px;font-size:13px;text-align:center;display:flex;align-items:center;justify-content:center;gap:10px}
        .info-note i{font-size:18px}
        .plans-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:24px}
        .plan-card{background:white;border-radius:20px;padding:24px;box-shadow:0 2px 16px rgba(0,0,0,.08);transition:all .3s;position:relative;border:2px solid transparent}
        .plan-card:hover{transform:translateY(-6px);box-shadow:0 12px 32px rgba(0,0,0,.15);border-color:#10b981}
        .plan-card.featured{border-color:#10b981;background:linear-gradient(135deg,#fff 0%,#f0fdf4 100%)}
        .featured-badge{position:absolute;top:16px;right:16px;background:linear-gradient(135deg,#10b981,#059669);color:white;padding:6px 14px;border-radius:20px;font-size:11px;font-weight:700;text-transform:uppercase;box-shadow:0 2px 8px rgba(16,185,129,.3)}
        .plan-header{text-align:center;margin-bottom:20px;padding-bottom:20px;border-bottom:2px solid #e2e8f0}
        .plan-icon{width:56px;height:56px;margin:0 auto 14px;background:linear-gradient(135deg,#10b981,#059669);border-radius:14px;display:flex;align-items:center;justify-content:center;font-size:24px;color:white;box-shadow:0 4px 12px rgba(16,185,129,.25)}
        .plan-name{font-size:20px;color:#0f172a;font-weight:700;margin-bottom:6px}
        .plan-period{color:#64748b;font-size:13px;font-weight:600;text-transform:uppercase;letter-spacing:.5px}
        .plan-price{text-align:center;margin:20px 0;padding:16px;background:#f8fafc;border-radius:12px}
        .price-label{color:#64748b;font-size:11px;font-weight:600;text-transform:uppercase;margin-bottom:8px}
        .price-amount{font-size:36px;color:#0f172a;font-weight:700}
        .price-amount span{font-size:18px;color:#10b981}
        .plan-interest{background:linear-gradient(135deg,#10b981,#059669);color:white;padding:12px;border-radius:12px;text-align:center;margin:16px 0;font-size:14px;font-weight:700;box-shadow:0 2px 8px rgba(16,185,129,.25)}
        .plan-interest .percentage{font-size:24px;display:block;margin-bottom:4px}
        .daily-income{background:#f0fdf4;border:2px solid #10b981;color:#059669;padding:10px;border-radius:10px;text-align:center;margin:12px 0;font-size:13px;font-weight:600}
        .plan-features{list-style:none;margin:16px 0}
        .plan-features li{padding:8px 0;color:#475569;display:flex;align-items:center;font-size:13px}
        .plan-features li i{color:#10b981;font-size:14px;margin-right:10px;flex-shrink:0}
        .purchase-btn{width:100%;padding:14px;background:linear-gradient(135deg,#10b981,#059669);color:white;border:none;border-radius:12px;font-size:14px;font-weight:700;cursor:pointer;transition:all .3s;text-transform:uppercase;box-shadow:0 2px 8px rgba(16,185,129,.25)}
        .purchase-btn:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 6px 20px rgba(16,185,129,.4)}
        .purchase-btn:disabled{opacity:.6;cursor:not-allowed;background:#94a3b8}
        .modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.6);z-index:1000;backdrop-filter:blur(4px);padding:40px 20px;overflow-y:auto}
        .modal.active{display:block}
        .modal-content{background:white;border-radius:12px;padding:24px;max-width:400px;width:90%;box-shadow:0 20px 60px rgba(0,0,0,.3);margin:60px auto;position:relative}
        .modal h3{font-size:18px;color:#0f172a;margin-bottom:16px;text-align:center;font-weight:700}
        .confirm-amount{background:linear-gradient(135deg,#f0fdf4,#dcfce7);border:2px solid #10b981;border-radius:8px;padding:16px;text-align:center;margin-bottom:16px}
        .confirm-label{color:#059669;font-size:12px;font-weight:600;margin-bottom:6px}
        .confirm-value{color:#10b981;font-size:32px;font-weight:700}
        .summary{background:#f8fafc;padding:12px;border-radius:8px;margin-bottom:12px}
        .summary-row{display:flex;justify-content:space-between;padding:6px 0;font-size:13px}
        .summary-row span{color:#64748b}
        .summary-row strong{color:#0f172a;font-weight:600}
        .modal-actions{display:flex;gap:10px;margin-top:16px}
        .modal-btn{flex:1;padding:12px;border:none;border-radius:8px;font-size:13px;font-weight:700;cursor:pointer;transition:all .3s}
        .modal-btn.cancel{background:#f1f5f9;color:#475569}
        .modal-btn.confirm{background:linear-gradient(135deg,#10b981,#059669);color:white}
        .modal-btn:disabled{opacity:.6;cursor:not-allowed}
        .error{background:#fee2e2;border:1px solid #dc2626;color:#dc2626;padding:10px;border-radius:8px;font-size:12px;margin-top:10px;display:none}
        .error.show{display:block}
        .spinner{display:inline-block;width:14px;height:14px;border:2px solid #e0e0e0;border-top-color:#10b981;border-radius:50%;animation:spin .8s linear infinite}
        @keyframes spin{to{transform:rotate(360deg)}}
        @media(max-width:768px){
            body{padding:20px 16px}
            .header h1{font-size:24px}
            .plans-grid{grid-template-columns:1fr}
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Choose Your Investment Plan</h1>
            <p>Start growing your wealth with flexible options</p>
        </div>

        <div class="info-note">
            <i class="fas fa-lightbulb"></i>
            <div><strong>Note:</strong> All investments are in Naira (₦). Returns are calculated daily and accumulate until you claim them.</div>
        </div>

        <div class="balance-display">
            <div class="balance-content">
                <div class="balance-label">Available Balance</div>
                <div class="balance-amount" id="userBalance"><span class="spinner"></span></div>
            </div>
        </div>

        <div class="plans-grid" id="plansGrid"></div>
    </div>

    <div class="modal" id="modal">
        <div class="modal-content">
            <h3 id="modalTitle">Confirm Investment</h3>
            <div class="confirm-amount">
                <div class="confirm-label">Investment Amount</div>
                <div class="confirm-value" id="confirmAmount">₦0.00</div>
            </div>
            <div class="summary">
                <div class="summary-row"><span>Plan:</span><strong id="sPlan">-</strong></div>
                <div class="summary-row"><span>Daily Income:</span><strong id="sDaily">-</strong></div>
                <div class="summary-row"><span>Total Returns:</span><strong id="sReturns">-</strong></div>
                <div class="summary-row"><span>Duration:</span><strong id="sDuration">-</strong></div>
            </div>
            <div class="error" id="error"></div>
            <div class="modal-actions">
                <button class="modal-btn cancel" onclick="closeModal()">Cancel</button>
                <button class="modal-btn confirm" id="confirmBtn" onclick="confirmPurchase()">Invest Now</button>
            </div>
        </div>
    </div>

    <script>
        // ========== EDIT PLAN PRICES HERE ==========
        // cost = what user pays, income = what they earn daily
        const PLANS = {
            starter: { cost: 3000, income: 1000, duration: '24hrs' },
            bronze: { cost: 6000, income: 2000, duration: '24hrs' },
            silver: { cost: 10000, income: 3500, duration: '24hrs' },
            gold: { cost: 15000, income: 5500, duration: '24hrs' },
            platinum: { cost: 25000, income: 8000, duration: '24hrs' }
        };
        // ===========================================
    </script>

    <script type="module">
        import{onAuthStateChanged}from"https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";
        import{ref,get,update}from"https://www.gstatic.com/firebasejs/10.7.0/firebase-database.js";
        import{auth,database}from"./lib/firebase.js";

        const plans=[
            {id:'starter',name:'Starter Plan',icon:'seedling',badge:'Beginner'},
            {id:'bronze',name:'Bronze Plan',icon:'medal',featured:true,badge:'Popular'},
            {id:'silver',name:'Silver Plan',icon:'award'},
            {id:'gold',name:'Gold Plan',icon:'crown',featured:true,badge:'Best Value'},
            {id:'platinum',name:'Platinum Plan',icon:'gem',badge:'Elite'}
        ];

        let user,balance=0,selectedPlan=null;

        onAuthStateChanged(auth,async u=>{
            if(!u)return window.location.href='/login';
            user=u;
            const snap=await get(ref(database,'users/'+u.uid));
            if(snap.exists()){
                balance=snap.val().balance||0;
                document.getElementById('userBalance').textContent='₦'+balance.toLocaleString('en-NG',{minimumFractionDigits:2,maximumFractionDigits:2});
            }
        });

        const grid=document.getElementById('plansGrid');
        plans.forEach(p=>{
            const cfg=window.PLANS[p.id];
            const daily=cfg.income;
            const roi=((cfg.income/cfg.cost)*100).toFixed(0);

            grid.innerHTML+=`
                <div class="plan-card ${p.featured?'featured':''}">
                    ${p.badge?`<span class="featured-badge">${p.badge}</span>`:''}
                    <div class="plan-header">
                        <div class="plan-icon"><i class="fas fa-${p.icon}"></i></div>
                        <div class="plan-name">${p.name}</div>
                        <div class="plan-period">${cfg.duration} Investment</div>
                    </div>
                    <div class="plan-price">
                        <div class="price-label">Investment Amount</div>
                        <div class="price-amount">₦${cfg.cost.toLocaleString()}</div>
                    </div>
                    <div class="plan-interest">
                        <span class="percentage">${roi}%</span>
                        Daily ROI
                    </div>
                    <div class="daily-income">
                        <i class="fas fa-coins"></i> Daily Income: ₦${daily.toLocaleString()}
                    </div>
                    <ul class="plan-features">
                        <li><i class="fas fa-check-circle"></i>Investment: ₦${cfg.cost.toLocaleString()}</li>
                        <li><i class="fas fa-check-circle"></i>Daily Earnings: ₦${cfg.income.toLocaleString()}</li>
                        <li><i class="fas fa-check-circle"></i>Duration: ${cfg.duration}</li>
                        <li><i class="fas fa-check-circle"></i>Claim earnings anytime</li>
                        <li><i class="fas fa-check-circle"></i>Auto-completes at maturity</li>
                        <li><i class="fas fa-check-circle"></i>24/7 Support</li>
                    </ul>
                    <button class="purchase-btn" onclick="openModal('${p.id}')">
                        <i class="fas fa-rocket"></i> Invest Now
                    </button>
                </div>
            `;
        });

        window.openModal=id=>{
            selectedPlan=plans.find(p=>p.id===id);
            const cfg=window.PLANS[id];

            document.getElementById('modalTitle').textContent=`Confirm ${selectedPlan.name}`;
            document.getElementById('confirmAmount').textContent='₦'+cfg.cost.toLocaleString();
            document.getElementById('sPlan').textContent=selectedPlan.name;
            document.getElementById('sDaily').textContent='₦'+cfg.income.toLocaleString();
            document.getElementById('sReturns').textContent='₦'+cfg.income.toLocaleString()+'/day';
            document.getElementById('sDuration').textContent=cfg.duration;
            document.getElementById('modal').classList.add('active');
            document.getElementById('error').classList.remove('show');
        };

        window.closeModal=()=>document.getElementById('modal').classList.remove('active');

        window.confirmPurchase=async()=>{
            const cfg=window.PLANS[selectedPlan.id];
            const btn=document.getElementById('confirmBtn');
            const err=document.getElementById('error');

            if(balance<cfg.cost){
                err.textContent='Insufficient balance. Please fund your account.';
                err.classList.add('show');
                return;
            }

            btn.disabled=true;
            btn.innerHTML='<span class="spinner"></span> Processing...';

            try{
                const now=Date.now();
                const newBalance=balance-cfg.cost;
                const investmentData={
                    planId:selectedPlan.id,
                    planName:selectedPlan.name,
                    amount:cfg.cost,
                    dailyIncome:cfg.income,
                    duration:cfg.duration,
                    startDate:now,
                    maturityDate:now+86400000,
                    status:'active',
                    totalClaimed:0,
                    lastClaimDate:null
                };

                await update(ref(database,'users/'+user.uid),{
                    balance:newBalance,
                    [`investments/${now}`]:investmentData
                });

                balance=newBalance;
                alert('Investment successful! Check your dashboard.');
                closeModal();
                document.getElementById('userBalance').textContent='₦'+balance.toLocaleString('en-NG',{minimumFractionDigits:2,maximumFractionDigits:2});
            }catch(e){
                err.textContent='Error: '+e.message;
                err.classList.add('show');
            }finally{
                btn.disabled=false;
                btn.innerHTML='Invest Now';
            }
        };
    </script>
</body>
    </html>
