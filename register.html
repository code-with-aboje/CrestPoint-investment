<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crest Point - Sign Up</title>
    <link rel="icon" type="image/png" href="/favicon.png">
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',Arial,sans-serif;background:#fafafa;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px}
        .main-container{max-width:400px;width:100%}
        .logo-section{text-align:center;margin-bottom:40px}
        .logo-wrapper{display:inline-flex;align-items:center;gap:12px;margin-bottom:8px}
        .logo-icon img{width:40px;height:40px;border-radius:8px}
        .logo-text{font-size:24px;font-weight:600;color:#000;letter-spacing:-0.5px}
        .card{background:white;border:1px solid #e5e5e5;border-radius:12px;padding:32px;box-shadow:0 1px 3px rgba(0,0,0,.05)}
        .card-header{text-align:center;margin-bottom:32px}
        .card-title{font-size:24px;font-weight:600;color:#000;margin-bottom:8px}
        .card-subtitle{font-size:14px;color:#666}
        .form-group{margin-bottom:20px}
        label{display:block;color:#000;font-size:14px;font-weight:500;margin-bottom:6px}
        input,select{width:100%;padding:10px 12px;border:1px solid #e5e5e5;border-radius:6px;font-size:14px;transition:all .2s ease;outline:none;font-family:inherit;background:white}
        input:focus,select:focus{border-color:#10b981;box-shadow:0 0 0 3px rgba(16,185,129,.1)}
        input::placeholder{color:#999}
        select{cursor:pointer}
        .password-toggle{position:relative}
        .password-toggle input{padding-right:40px}
        .toggle-btn{position:absolute;right:12px;top:50%;transform:translateY(-50%);background:none;border:none;color:#666;cursor:pointer;font-size:16px;padding:4px;display:flex;align-items:center;justify-content:center;transition:color .2s ease}
        .toggle-btn:hover{color:#10b981}
        .checkbox-group{display:flex;align-items:flex-start;gap:8px;margin-bottom:24px}
        .checkbox-group input[type="checkbox"]{width:auto;margin:0;margin-top:2px;cursor:pointer;accent-color:#10b981;flex-shrink:0}
        .checkbox-group label{margin:0;font-weight:400;color:#666;cursor:pointer;font-size:14px;line-height:1.5}
        .checkbox-group a{color:#10b981;text-decoration:none;font-weight:500}
        .checkbox-group a:hover{text-decoration:underline}
        .submit-btn{width:100%;padding:10px;background:#10b981;color:white;border:none;border-radius:6px;font-size:14px;font-weight:500;cursor:pointer;transition:all .2s ease;position:relative;overflow:hidden}
        .submit-btn::before{content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,.3),transparent);animation:wave 2s infinite}
        @keyframes wave{0%{left:-100%}100%{left:100%}}
        .submit-btn:hover{background:#059669}
        .submit-btn:active{transform:scale(.98)}
        .submit-btn:disabled{opacity:.5;cursor:not-allowed}
        .divider{display:flex;align-items:center;text-align:center;margin:24px 0;color:#999;font-size:13px}
        .divider::before,.divider::after{content:'';flex:1;border-bottom:1px solid #e5e5e5}
        .divider::before{margin-right:12px}
        .divider::after{margin-left:12px}
        .signin-link{text-align:center;color:#666;font-size:14px}
        .signin-link a{color:#10b981;text-decoration:none;font-weight:500}
        .signin-link a:hover{text-decoration:underline}
        .error-message,.success-message{font-size:13px;margin-bottom:20px;padding:10px 12px;border-radius:6px;display:none}
        .error-message{color:#ef4444;background:#fef2f2;border:1px solid #fecaca}
        .success-message{color:#10b981;background:#f0fdf4;border:1px solid #bbf7d0}
        .error-message.show,.success-message.show{display:block}
        .eye-icon{width:16px;height:16px}
        @media (max-width:480px){.card{padding:24px}.card-title{font-size:20px}}
    </style>
</head>
<body>
    <div class="main-container">
        <div class="logo-section">
            <div class="logo-wrapper">
                <div class="logo-icon"><img src="favicon.png" alt="Crest Point Logo"></div>
                <span class="logo-text">Crest Point</span>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h1 class="card-title">Create your account</h1>
                <p class="card-subtitle">Get started with Crest Point</p>
            </div>

            <div class="error-message" id="errorMessage"></div>
            <div class="success-message" id="successMessage"></div>

            <form id="signupForm">
                <div class="form-group">
                    <label for="fullName">Full Name</label>
                    <input type="text" id="fullName" placeholder="John Doe" required autocomplete="name">
                </div>

                <div class="form-group">
                    <label for="email">Email Address</label>
                    <input type="email" id="email" placeholder="name@example.com" required autocomplete="email">
                </div>

                <div class="form-group">
                    <label for="country">Country</label>
                    <select id="country" required>
                        <option value="">Select Country</option>
                        <option value="us">United States</option>
                        <option value="uk">United Kingdom</option>
                        <option value="ca">Canada</option>
                        <option value="au">Australia</option>
                        <option value="ng">Nigeria</option>
                        <option value="za">South Africa</option>
                        <option value="gh">Ghana</option>
                        <option value="ke">Kenya</option>
                        <option value="other">Other</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="referralCode">Referral Code (Optional)</label>
                    <input type="text" id="referralCode" placeholder="Enter referral code" autocomplete="off">
                </div>

                <div class="form-group password-toggle">
                    <label for="password">Password</label>
                    <input type="password" id="password" placeholder="••••••••" required autocomplete="new-password">
                    <button type="button" class="toggle-btn" onclick="togglePassword()">
                        <svg class="eye-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path id="eyeOpen" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                            <path id="eyeOpen2" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                        </svg>
                    </button>
                </div>

                <div class="checkbox-group">
                    <input type="checkbox" id="terms" required>
                    <label for="terms">I agree to the <a href="#">Terms of Service</a> and <a href="#">Privacy Policy</a></label>
                </div>

                <button type="submit" class="submit-btn" id="submitBtn">Create Account</button>
            </form>

            <div class="divider">or</div>

            <div class="signin-link">Already have an account? <a href="/login.html">Sign in</a></div>
        </div>
    </div>

    <script type="module">
        import{createUserWithEmailAndPassword,updateProfile}from"https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";
        import{ref,set,get,update}from"https://www.gstatic.com/firebasejs/10.7.0/firebase-database.js";
        import{auth,database}from"./lib/firebase.js";

        const params=new URLSearchParams(window.location.search);
        if(params.get('ref'))document.getElementById('referralCode').value=params.get('ref');

        window.togglePassword=function(){
            const field=document.getElementById('password'),eyeOpen=document.getElementById('eyeOpen'),eyeOpen2=document.getElementById('eyeOpen2');
            if(field.type==='password'){
                field.type='text';
                eyeOpen.setAttribute('d','M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21');
                eyeOpen2.setAttribute('d','');
            }else{
                field.type='password';
                eyeOpen.setAttribute('d','M15 12a3 3 0 11-6 0 3 3 0 016 0z');
                eyeOpen2.setAttribute('d','M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z');
            }
        }

        const generateCode=()=>Math.random().toString(36).substring(2,8).toUpperCase();

        document.getElementById('signupForm').addEventListener('submit',async function(e){
            e.preventDefault();
            const fullName=document.getElementById('fullName').value,email=document.getElementById('email').value,country=document.getElementById('country').value,password=document.getElementById('password').value,refCode=document.getElementById('referralCode').value.trim(),terms=document.getElementById('terms').checked,submitBtn=document.getElementById('submitBtn'),errorMessage=document.getElementById('errorMessage'),successMessage=document.getElementById('successMessage');
            
            errorMessage.classList.remove('show');
            successMessage.classList.remove('show');
            
            if(password.length<8){errorMessage.textContent='Password must be at least 8 characters long.';errorMessage.classList.add('show');return}
            if(!terms){errorMessage.textContent='Please accept the Terms of Service to continue.';errorMessage.classList.add('show');return}
            
            submitBtn.disabled=true;
            submitBtn.textContent='Creating Account...';

            try{
                let referrerId=null;
                if(refCode){
                    const snapshot=await get(ref(database,'referralCodes/'+refCode));
                    if(snapshot.exists())referrerId=snapshot.val().userId;
                }

                const userCredential=await createUserWithEmailAndPassword(auth,email,password);
                const user=userCredential.user;
                await updateProfile(user,{displayName:fullName});

                const now=new Date().toISOString();
                const myRefCode=generateCode();
                const userData={
                    uid:user.uid,
                    fullName,email,country,
                    balance:0,totalClaimed:0,
                    referralCode:myRefCode,
                    referredBy:referrerId,
                    referrals:[],
                    totalReferralEarnings:0,
                    createdAt:now,
                    updatedAt:now
                };

                await set(ref(database,'users/'+user.uid),userData);
                await set(ref(database,'referralCodes/'+myRefCode),{userId:user.uid,createdAt:now});

                if(referrerId){
                    const refSnap=await get(ref(database,'users/'+referrerId));
                    if(refSnap.exists()){
                        const refData=refSnap.val();
                        const bonus=100;
                        await update(ref(database,'users/'+referrerId),{
                            referrals:[...(refData.referrals||[]),{userId:user.uid,name:fullName,email,joinedAt:now,earned:0}],
                            balance:(refData.balance||0)+bonus,
                            totalReferralEarnings:(refData.totalReferralEarnings||0)+bonus
                        });
                    }
                }

                successMessage.textContent='Account created successfully! Redirecting to login...';
                successMessage.classList.add('show');
                setTimeout(()=>window.location.href='/login.html',2000);
            }catch(error){
                let errorText='Failed to create account. Please try again.';
                if(error.code==='auth/email-already-in-use')errorText='An account with this email already exists.';
                else if(error.code==='auth/invalid-email')errorText='Invalid email address.';
                else if(error.code==='auth/weak-password')errorText='Password is too weak. Please use a stronger password.';
                errorMessage.textContent=errorText;
                errorMessage.classList.add('show');
                submitBtn.disabled=false;
                submitBtn.textContent='Create Account';
            }
        });
    </script>
</body>
                                </html>
