<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile - BluStone</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:Inter,sans-serif;background:#fafafa;padding:24px;min-height:100vh;padding-bottom:100px}
        .container{max-width:1200px;margin:0 auto}
        .profile-header{background:linear-gradient(135deg,#10b981,#059669);border-radius:24px;padding:32px;color:#fff;box-shadow:0 4px 20px rgba(16,185,129,.2);margin-bottom:24px;position:relative;overflow:hidden}
        .profile-header::before{content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,.3),transparent);animation:shine 3s infinite}
        @keyframes shine{0%{left:-100%}50%,100%{left:100%}}
        .profile-top{display:flex;align-items:center;gap:20px;position:relative;z-index:1}
        .avatar{width:80px;height:80px;border-radius:50%;background:#fff;display:flex;align-items:center;justify-content:center;font-size:28px;font-weight:700;color:#10b981;box-shadow:0 8px 24px rgba(0,0,0,.15);overflow:hidden;flex-shrink:0}
        .avatar img{width:100%;height:100%;object-fit:cover}
        .profile-info{flex:1}
        .profile-info h1{font-size:26px;font-weight:700;margin-bottom:8px}
        .profile-meta{display:flex;gap:20px;font-size:13px;opacity:.95;flex-wrap:wrap}
        .profile-meta-item{display:flex;align-items:center;gap:6px}
        .checkin-card{background:linear-gradient(135deg,#667eea,#764ba2);border-radius:20px;padding:32px;margin-bottom:24px;color:#fff;box-shadow:0 8px 32px rgba(102,126,234,.3);position:relative;overflow:hidden}
        .checkin-card::after{content:'';position:absolute;top:-50%;right:-50%;width:200%;height:200%;background:radial-gradient(circle,rgba(255,255,255,.15),transparent 60%);animation:float 8s ease-in-out infinite}
        @keyframes float{0%,100%{transform:translate(0,0) rotate(0deg)}50%{transform:translate(-20px,-20px) rotate(180deg)}}
        .checkin-grid{display:grid;grid-template-columns:1fr auto;gap:24px;align-items:center;position:relative;z-index:1}
        .checkin-left h3{font-size:20px;font-weight:700;margin-bottom:8px;display:flex;align-items:center;gap:10px}
        .checkin-amount{font-size:48px;font-weight:700;margin:12px 0;text-shadow:0 2px 10px rgba(0,0,0,.2)}
        .checkin-streak{background:rgba(255,255,255,.2);padding:8px 16px;border-radius:12px;font-size:14px;font-weight:600;backdrop-filter:blur(10px);display:inline-block;margin-top:8px}
        .checkin-btn{padding:16px 32px;background:#fff;color:#667eea;border:none;border-radius:12px;font-size:16px;font-weight:700;cursor:pointer;transition:all .3s;box-shadow:0 4px 12px rgba(0,0,0,.15);min-width:180px}
        .checkin-btn:hover:not(:disabled){transform:translateY(-2px) scale(1.05);box-shadow:0 6px 20px rgba(0,0,0,.25)}
        .checkin-btn:disabled{opacity:.6;cursor:not-allowed;background:rgba(255,255,255,.7)}
        .checkin-info{text-align:center;margin-top:16px;font-size:13px;opacity:.9;position:relative;z-index:1}
        .grid{display:grid;grid-template-columns:1fr 1fr;gap:24px;margin-bottom:24px}
        .card{background:#fff;border-radius:20px;padding:32px;box-shadow:0 2px 12px rgba(0,0,0,.08)}
        .card-title{font-size:20px;font-weight:700;color:#0f172a;margin-bottom:24px}
        .info-row{display:flex;justify-content:space-between;padding:16px 0;border-bottom:1px solid #f1f5f9}
        .info-row:last-child{border-bottom:none}
        .info-label{font-size:14px;color:#64748b;font-weight:500}
        .info-value{font-size:14px;color:#0f172a;font-weight:600}
        .badge{display:inline-flex;align-items:center;gap:6px;padding:6px 12px;border-radius:8px;font-size:13px;font-weight:600}
        .badge-success{background:#d1fae5;color:#065f46}
        .badge-warning{background:#fef3c7;color:#92400e}
        .spinner{display:inline-block;width:12px;height:12px;border:2px solid #e0e0e0;border-top-color:#10b981;border-radius:50%;animation:spin .8s linear infinite}
        @keyframes spin{to{transform:rotate(360deg)}}
        @media(max-width:768px){body{padding:16px}.grid{grid-template-columns:1fr}.profile-top{flex-direction:column;text-align:center}.profile-meta{justify-content:center;flex-direction:column;gap:8px}.card{padding:20px}.checkin-grid{grid-template-columns:1fr;text-align:center}}
    </style>
</head>
<body>
    <div class="container">
        <div class="profile-header">
            <div class="profile-top">
                <div class="avatar" id="avatar"><span id="initials">JI</span></div>
                <div class="profile-info">
                    <h1 id="name"><span class="spinner"></span> Loading...</h1>
                    <div class="profile-meta">
                        <div class="profile-meta-item"><i class="fas fa-envelope"></i><span id="email">-</span></div>
                        <div class="profile-meta-item"><i class="fas fa-calendar"></i><span id="joined">-</span></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="checkin-card">
            <div class="checkin-grid">
                <div class="checkin-left">
                    <h3><i class="fas fa-gift"></i> Daily Check-in Reward</h3>
                    <div class="checkin-amount">â‚¦200</div>
                    <div class="checkin-streak">ðŸ”¥ <span id="streak">0</span> Day Streak</div>
                </div>
                <button class="checkin-btn" id="btn"><i class="fas fa-hand-pointer"></i> Claim Reward</button>
            </div>
            <div class="checkin-info" id="info">Check in daily to earn rewards!</div>
        </div>

        <div class="grid">
            <div class="card">
                <h2 class="card-title">Account Details</h2>
                <div class="info-row"><span class="info-label">Full Name</span><span class="info-value" id="n1"><span class="spinner"></span></span></div>
                <div class="info-row"><span class="info-label">Email</span><span class="info-value" id="e1"><span class="spinner"></span></span></div>
                <div class="info-row"><span class="info-label">Account Type</span><span class="info-value">Standard</span></div>
                <div class="info-row"><span class="info-label">Status</span><span class="badge badge-success"><i class="fas fa-check-circle"></i> Active</span></div>
                <div class="info-row"><span class="info-label">Risk Profile</span><span class="badge badge-warning"><i class="fas fa-chart-line"></i> Moderate</span></div>
            </div>

            <div class="card">
                <h2 class="card-title">Additional Information</h2>
                <div class="info-row"><span class="info-label">Last Sign In</span><span class="info-value" id="lastSign"><span class="spinner"></span></span></div>
                <div class="info-row"><span class="info-label">Created</span><span class="info-value" id="created"><span class="spinner"></span></span></div>
                <div class="info-row"><span class="info-label">Last Check-in</span><span class="info-value" id="lastCheck">Never</span></div>
                <div class="info-row"><span class="info-label">Total Check-ins</span><span class="info-value" id="total">0</span></div>
            </div>
        </div>
    </div>

    <script type="module">
        import{onAuthStateChanged}from"https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";
        import{ref,get,update}from"https://www.gstatic.com/firebasejs/10.7.0/firebase-database.js";
        import{auth,database}from"./lib/firebase.js";

        let user,userData;

        onAuthStateChanged(auth,async u=>{
            if(!u){
                document.getElementById('name').textContent='Not Logged In';
                return;
            }
            user=u;
            const snap=await get(ref(database,`users/${u.uid}`));
            userData=snap.exists()?snap.val():{};
            
            const displayName=userData.fullName||u.displayName||u.email?.split('@')[0]||'User';
            const email=u.email||'-';
            const created=new Date(u.metadata.creationTime).toLocaleDateString('en-US',{year:'numeric',month:'short',day:'numeric'});
            const lastSignIn=new Date(u.metadata.lastSignInTime).toLocaleDateString('en-US',{year:'numeric',month:'short',day:'numeric'});
            
            document.getElementById('name').textContent=displayName;
            document.getElementById('email').textContent=email;
            document.getElementById('joined').textContent=`Member since ${created}`;
            document.getElementById('n1').textContent=displayName;
            document.getElementById('e1').textContent=email;
            document.getElementById('lastSign').textContent=lastSignIn;
            document.getElementById('created').textContent=created;
            
            const initials=displayName.split(' ').map(n=>n[0]).join('').toUpperCase();
            document.getElementById('initials').textContent=initials;
            
            if(u.photoURL){
                const img=document.createElement('img');
                img.src=u.photoURL;
                document.getElementById('avatar').innerHTML='';
                document.getElementById('avatar').appendChild(img);
            }
            
            updateCheckin();
        });

        function updateCheckin(){
            const lastCheckin=userData.lastCheckin||0;
            const streak=userData.checkinStreak||0;
            const totalCheckins=userData.totalCheckins||0;
            
            document.getElementById('streak').textContent=streak;
            document.getElementById('total').textContent=totalCheckins;
            
            if(lastCheckin){
                const date=new Date(lastCheckin).toLocaleDateString('en-US',{year:'numeric',month:'short',day:'numeric'});
                document.getElementById('lastCheck').textContent=date;
            }
            
            const now=new Date();
            const lastDate=new Date(lastCheckin);
            const isSameDay=now.toDateString()===lastDate.toDateString();
            
            if(isSameDay){
                document.getElementById('btn').disabled=true;
                document.getElementById('btn').innerHTML='<i class="fas fa-check"></i> Claimed Today';
                const tomorrow=new Date(now);
                tomorrow.setDate(tomorrow.getDate()+1);
                tomorrow.setHours(0,0,0,0);
                const hours=Math.floor((tomorrow-now)/3600000);
                document.getElementById('info').textContent=`Come back in ${hours}h to claim tomorrow's reward`;
            }
        }

        document.getElementById('btn').onclick=async()=>{
            if(!user)return;
            
            const btn=document.getElementById('btn');
            btn.disabled=true;
            btn.innerHTML='<span class="spinner"></span> Processing...';
            
            try{
                const now=Date.now();
                const lastCheckin=userData.lastCheckin||0;
                const lastDate=new Date(lastCheckin);
                const today=new Date(now);
                
                let newStreak=1;
                if(lastCheckin){
                    const yesterday=new Date(today);
                    yesterday.setDate(yesterday.getDate()-1);
                    if(lastDate.toDateString()===yesterday.toDateString()){
                        newStreak=(userData.checkinStreak||0)+1;
                    }
                }
                
                const currentBalance=userData.balance||0;
                await update(ref(database,`users/${user.uid}`),{
                    balance:currentBalance+200,
                    lastCheckin:now,
                    checkinStreak:newStreak,
                    totalCheckins:(userData.totalCheckins||0)+1
                });
                
                userData.balance=currentBalance+200;
                userData.lastCheckin=now;
                userData.checkinStreak=newStreak;
                userData.totalCheckins=(userData.totalCheckins||0)+1;
                
                updateCheckin();
                alert('ðŸŽ‰ Success!\n\nâ‚¦200 has been added to your balance!');
            }catch(e){
                alert('Error: '+e.message);
                btn.disabled=false;
                btn.innerHTML='<i class="fas fa-hand-pointer"></i> Claim Reward';
            }
        };
    </script>
</body>
                                                                                      </html>
